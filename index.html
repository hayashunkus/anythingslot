<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãªã‚“ã§ã‚‚ã‚¹ãƒ­ãƒƒãƒˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ã‚¹ãƒ­ãƒƒãƒˆã®ç«‹ä½“æ„Ÿã¨å½± */
        .reel-container {
            box-shadow: inset 0px 10px 15px -3px rgba(0, 0, 0, 0.2), inset 0px -10px 15px -3px rgba(0, 0, 0, 0.2);
            background: linear-gradient(to bottom, #e5e7eb 0%, #ffffff 20%, #ffffff 80%, #e5e7eb 100%);
        }
        /* å›è»¢æ™‚ã®ã¼ã‹ã—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .blur-text {
            filter: blur(1.5px); /* é€Ÿåº¦ã‚’è½ã¨ã—ãŸã®ã§ã¼ã‹ã—ã‚’å°‘ã—å¼±ãèª¿æ•´ */
            opacity: 0.6;
        }
        /* ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ç”¨ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop-in {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-2 sm:p-4 md:p-8 font-sans text-gray-800 relative">
    <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ãƒˆãƒ¼ã‚¹ãƒˆ -->
    <div id="error-message" class="hidden fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-6 py-3 rounded-full shadow-xl z-50 font-bold text-sm sm:text-base transition-all duration-300 opacity-0 pointer-events-none"></div>

    <div class="max-w-5xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-200">
        
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 md:p-6 text-center shadow-md relative z-10">
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold tracking-wider">ğŸ° ãªã‚“ã§ã‚‚ã‚¹ãƒ­ãƒƒãƒˆ ğŸ°</h1>
            <p class="mt-2 text-blue-100 text-xs sm:text-sm md:text-base">æ°´ãƒ€ã‚¦ã€Œæº€è…¹ã˜ã‚ƒã‚“ã‘ã‚“ã€ãŒã§ãã‚‹ï¼ï¼ã˜ã‚ƒã‚“ã‘ã‚“ã«ã—ãŸã„é …ç›®ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¦ã­ï¼ï¼æ˜Ÿå½¢ãƒãƒ¼ã‚¯(â­)ãŒæƒã£ãŸã‚‰ãƒãƒ£ãƒ³ã‚¹ï¼ï¼Ÿ</p>
        </header>

        <div class="flex flex-col gap-10 md:gap-12 p-4 md:p-8 max-w-4xl mx-auto">
            
            <!-- ä¸Šæ®µï¼šãƒªã‚¹ãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ -->
            <div class="flex flex-col w-full">
                <div class="bg-blue-50 p-4 sm:p-6 rounded-xl border border-blue-100 flex flex-col shadow-sm">
                    <h2 class="text-lg sm:text-xl font-bold mb-4 text-blue-800 flex items-center">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                        1. é …ç›®ã‚’å…¥åŠ› (æœ€ä½3ã¤)
                    </h2>
                    
                    <div class="flex gap-2 mb-6">
                        <input type="text" id="item-input" class="flex-1 w-full border-2 border-gray-300 rounded-lg px-3 sm:px-4 py-2 sm:py-3 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition text-base sm:text-lg" placeholder="ä¾‹ï¼šç„¼è‚‰ã€ãƒ©ãƒ¼ãƒ¡ãƒ³...">
                        <button id="add-btn" class="bg-blue-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg hover:bg-blue-700 active:bg-blue-800 transition font-bold shadow whitespace-nowrap">è¿½åŠ </button>
                    </div>

                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-base sm:text-lg font-bold text-gray-700">ã‚¹ãƒ­ãƒƒãƒˆå€™è£œãƒªã‚¹ãƒˆ</h2>
                        <div class="flex items-center gap-2">
                            <button id="edit-btn" class="text-xs sm:text-sm bg-gray-200 text-gray-700 px-3 py-1 rounded hover:bg-gray-300 transition font-bold">é¸æŠå‰Šé™¤</button>
                            <button id="delete-selected-btn" class="hidden text-xs sm:text-sm bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition font-bold shadow-sm">å‰Šé™¤å®Ÿè¡Œ</button>
                            <button id="cancel-edit-btn" class="hidden text-xs sm:text-sm bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600 transition font-bold shadow-sm">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                            <span class="text-xs sm:text-sm text-gray-500 font-medium ml-2">é …ç›®æ•°: <span id="item-count" class="text-blue-600 font-bold">0</span></span>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-3 sm:p-4 border border-gray-200 overflow-y-auto max-h-[250px] shadow-inner">
                        <ul id="item-list" class="space-y-2">
                            <li class="text-gray-400 italic text-center py-8 text-sm sm:text-base">é …ç›®ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- ä¸‹æ®µï¼šã‚¹ãƒ­ãƒƒãƒˆã‚¨ãƒªã‚¢ -->
            <div class="flex flex-col items-center justify-center w-full">
                <h2 class="text-lg sm:text-2xl font-bold mb-6 text-gray-800 w-full text-center">2. ã‚¹ãƒ­ãƒƒãƒˆã‚’å›ã™</h2>
                
                <!-- ã‚¹ãƒ­ãƒƒãƒˆãƒã‚·ãƒ³æœ¬ä½“ -->
                <div class="bg-gray-800 p-6 sm:p-8 md:p-10 rounded-3xl shadow-2xl mb-8 md:mb-10 relative border-4 border-gray-700 w-full max-w-2xl">
                    <!-- ãƒã‚·ãƒ³ã®è£…é£¾ -->
                    <div class="absolute top-3 left-3 right-3 flex justify-between px-2 sm:px-6">
                        <div class="w-3 h-3 sm:w-4 sm:h-4 rounded-full bg-red-500 animate-pulse"></div>
                        <div class="w-3 h-3 sm:w-4 sm:h-4 rounded-full bg-yellow-400 animate-pulse" style="animation-delay: 0.5s"></div>
                        <div class="w-3 h-3 sm:w-4 sm:h-4 rounded-full bg-green-500 animate-pulse" style="animation-delay: 1s"></div>
                    </div>

                    <!-- åˆ¤å®šãƒ©ã‚¤ãƒ³ï¼ˆæ¨ªä¸­å¤®ä¸€ç›´ç·šï¼‰ -->
                    <div class="absolute w-[calc(100%-1.5rem)] sm:w-[calc(100%-3rem)] md:w-[calc(100%-4rem)] h-1.5 sm:h-2 bg-red-500 top-1/2 transform -translate-y-1/2 z-10 opacity-80 left-3 sm:left-6 md:left-8 pointer-events-none shadow-[0_0_12px_rgba(239,68,68,1)] md:shadow-[0_0_16px_rgba(239,68,68,1)]"></div>
                    
                    <div class="flex justify-center gap-4 sm:gap-6 md:gap-10 mt-6 sm:mt-8">
                        <!-- å·¦ãƒªãƒ¼ãƒ« -->
                        <div class="reel-container relative w-24 h-36 sm:w-36 sm:h-56 md:w-48 md:h-72 rounded-xl flex flex-col justify-between items-center py-2 sm:py-4 overflow-hidden border-2 border-gray-400">
                            <div id="reel-0-top" class="text-xl sm:text-3xl md:text-4xl text-gray-400 font-bold">?</div>
                            <div id="reel-0-center" class="text-5xl sm:text-7xl md:text-8xl font-black text-gray-900 z-20">?</div>
                            <div id="reel-0-bottom" class="text-xl sm:text-3xl md:text-4xl text-gray-400 font-bold">?</div>
                        </div>
                        <!-- ä¸­ãƒªãƒ¼ãƒ« -->
                        <div class="reel-container relative w-24 h-36 sm:w-36 sm:h-56 md:w-48 md:h-72 rounded-xl flex flex-col justify-between items-center py-2 sm:py-4 overflow-hidden border-2 border-gray-400">
                            <div id="reel-1-top" class="text-xl sm:text-3xl md:text-4xl text-gray-400 font-bold">?</div>
                            <div id="reel-1-center" class="text-5xl sm:text-7xl md:text-8xl font-black text-gray-900 z-20">?</div>
                            <div id="reel-1-bottom" class="text-xl sm:text-3xl md:text-4xl text-gray-400 font-bold">?</div>
                        </div>
                        <!-- å³ãƒªãƒ¼ãƒ« -->
                        <div class="reel-container relative w-24 h-36 sm:w-36 sm:h-56 md:w-48 md:h-72 rounded-xl flex flex-col justify-between items-center py-2 sm:py-4 overflow-hidden border-2 border-gray-400">
                            <div id="reel-2-top" class="text-xl sm:text-3xl md:text-4xl text-gray-400 font-bold">?</div>
                            <div id="reel-2-center" class="text-5xl sm:text-7xl md:text-8xl font-black text-gray-900 z-20">?</div>
                            <div id="reel-2-bottom" class="text-xl sm:text-3xl md:text-4xl text-gray-400 font-bold">?</div>
                        </div>
                    </div>
                </div>

                <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ -->
                <div class="w-full flex justify-center items-center min-h-[80px] sm:min-h-[100px] mt-2 px-4">
                    <button id="start-btn" class="w-full max-w-[320px] sm:max-w-md bg-red-600 text-white text-2xl sm:text-3xl font-bold py-4 sm:py-5 px-6 sm:px-8 rounded-full shadow-[0_6px_0_#991b1b] sm:shadow-[0_8px_0_#991b1b] hover:bg-red-500 hover:shadow-[0_4px_0_#991b1b] sm:hover:shadow-[0_4px_0_#991b1b] hover:translate-y-[2px] sm:hover:translate-y-[4px] active:shadow-[0_0px_0_#991b1b] active:translate-y-[6px] sm:active:translate-y-[8px] transition-all">
                        ã‚¹ãƒ­ãƒƒãƒˆé–‹å§‹
                    </button>
                    <div id="stop-btns-container" class="hidden flex justify-center gap-4 sm:gap-6 md:gap-10 w-full max-w-2xl">
                        <button id="stop-btn-0" class="w-24 sm:w-36 md:w-48 bg-yellow-400 text-yellow-900 text-4xl sm:text-5xl md:text-6xl font-bold py-3 sm:py-4 rounded-full shadow-[0_6px_0_#b45309] sm:shadow-[0_8px_0_#b45309] hover:bg-yellow-300 hover:shadow-[0_4px_0_#b45309] sm:hover:shadow-[0_4px_0_#b45309] hover:translate-y-[2px] sm:hover:translate-y-[4px] active:shadow-[0_0px_0_#b45309] active:translate-y-[6px] sm:active:translate-y-[8px] disabled:shadow-[0_0px_0_#b45309] disabled:translate-y-[6px] sm:disabled:translate-y-[8px] disabled:opacity-60 disabled:cursor-not-allowed transition-all flex items-center justify-center">
                            âœŠ
                        </button>
                        <button id="stop-btn-1" class="w-24 sm:w-36 md:w-48 bg-yellow-400 text-yellow-900 text-4xl sm:text-5xl md:text-6xl font-bold py-3 sm:py-4 rounded-full shadow-[0_6px_0_#b45309] sm:shadow-[0_8px_0_#b45309] hover:bg-yellow-300 hover:shadow-[0_4px_0_#b45309] sm:hover:shadow-[0_4px_0_#b45309] hover:translate-y-[2px] sm:hover:translate-y-[4px] active:shadow-[0_0px_0_#b45309] active:translate-y-[6px] sm:active:translate-y-[8px] disabled:shadow-[0_0px_0_#b45309] disabled:translate-y-[6px] sm:disabled:translate-y-[8px] disabled:opacity-60 disabled:cursor-not-allowed transition-all flex items-center justify-center">
                            âœŒï¸
                        </button>
                        <button id="stop-btn-2" class="w-24 sm:w-36 md:w-48 bg-yellow-400 text-yellow-900 text-4xl sm:text-5xl md:text-6xl font-bold py-3 sm:py-4 rounded-full shadow-[0_6px_0_#b45309] sm:shadow-[0_8px_0_#b45309] hover:bg-yellow-300 hover:shadow-[0_4px_0_#b45309] sm:hover:shadow-[0_4px_0_#b45309] hover:translate-y-[2px] sm:hover:translate-y-[4px] active:shadow-[0_0px_0_#b45309] active:translate-y-[6px] sm:active:translate-y-[8px] disabled:shadow-[0_0px_0_#b45309] disabled:translate-y-[6px] sm:disabled:translate-y-[8px] disabled:opacity-60 disabled:cursor-not-allowed transition-all flex items-center justify-center">
                            ğŸ–ï¸
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="result-container" class="hidden bg-yellow-50 p-4 sm:p-6 md:p-10 border-t-4 border-yellow-400">
            <h2 class="text-2xl sm:text-3xl font-black text-center text-yellow-800 mb-6 sm:mb-8 tracking-wide">ğŸ¯ çµæœç™ºè¡¨ ğŸ¯</h2>
            <div id="result-area" class="max-w-2xl mx-auto">
                <!-- JSã§çµæœã‚’æŒ¿å…¥ -->
            </div>
        </div>
    </div>

    <script>
        // --- çŠ¶æ…‹ç®¡ç† ---
        let items = [];
        let nextId = 1;
        let reelIntervals = [null, null, null];
        
        // å›è»¢ãŒæ­¢ã¾ã£ãŸæ™‚ã«ä¸­å¤®ã«è¡¨ç¤ºã™ã‚‹æœ€çµ‚çš„ãªID
        let targetReelValues = [null, null, null]; 
        
        let isReelStopped = [false, false, false]; // å„ãƒªãƒ¼ãƒ«ã®åœæ­¢çŠ¶æ…‹
        let stoppedReels = 0; // åœæ­¢ã—ãŸãƒªãƒ¼ãƒ«ã®æ•°
        let isSpinning = false;
        let isDeleteMode = false; // å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰ã®çŠ¶æ…‹
        const STAR_MARK = 'â­'; // æ˜Ÿå½¢ãƒãƒ¼ã‚¯ã®å®šæ•°

        // --- DOMè¦ç´  ---
        const itemInput = document.getElementById('item-input');
        const addBtn = document.getElementById('add-btn');
        const itemList = document.getElementById('item-list');
        const itemCount = document.getElementById('item-count');
        const editBtn = document.getElementById('edit-btn');
        const deleteSelectedBtn = document.getElementById('delete-selected-btn');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const startBtn = document.getElementById('start-btn');
        const stopBtnsContainer = document.getElementById('stop-btns-container');
        const stopBtns = [
            document.getElementById('stop-btn-0'),
            document.getElementById('stop-btn-1'),
            document.getElementById('stop-btn-2')
        ];
        const resultContainer = document.getElementById('result-container');
        const resultArea = document.getElementById('result-area');

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
        addBtn.addEventListener('click', addItem);
        itemInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !isDeleteMode) addItem();
        });

        // å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ã‚¤ãƒ™ãƒ³ãƒˆ
        editBtn.addEventListener('click', () => {
            if (items.length === 0) return;
            isDeleteMode = true;
            updateEditModeUI();
            renderList();
        });

        // å‰Šé™¤ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆ
        cancelEditBtn.addEventListener('click', () => {
            isDeleteMode = false;
            updateEditModeUI();
            renderList();
        });

        // é¸æŠå‰Šé™¤å®Ÿè¡Œã‚¤ãƒ™ãƒ³ãƒˆ
        deleteSelectedBtn.addEventListener('click', () => {
            const checkboxes = itemList.querySelectorAll('.delete-checkbox:checked');
            // å€¤ã‚’ã™ã¹ã¦æ–‡å­—åˆ—ã«çµ±ä¸€ã—ã¦ç¢ºå®Ÿã«æ¯”è¼ƒã§ãã‚‹ã‚ˆã†ã«ä¿®æ­£
            const idsToDelete = Array.from(checkboxes).map(cb => String(cb.value));
            
            if (idsToDelete.length === 0) {
                showError('å‰Šé™¤ã™ã‚‹é …ç›®ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚');
                return;
            }

            // iframeç’°å¢ƒã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ãŸã‚ confirm ã¯ä½¿ç”¨ã›ãšã€å³åº§ã«å‰Šé™¤å‡¦ç†ã‚’å®Ÿè¡Œ
            items = items.filter(item => !idsToDelete.includes(String(item.id)));
            
            // æ®‹ã£ãŸé …ç›®ã®ç•ªå·ï¼ˆIDï¼‰ã‚’1ã‹ã‚‰é †ã«ç¶ºéº—ã«æŒ¯ã‚Šç›´ã™
            items.forEach((item, index) => {
                item.id = index + 1;
            });
            
            // æ¬¡ã«è¿½åŠ ã•ã‚Œã‚‹é …ç›®ã®ç•ªå·ã‚’æ›´æ–°ï¼ˆç©ºã«ãªã£ãŸå ´åˆã¯è‡ªå‹•çš„ã«1ã«ãªã‚‹ï¼‰
            nextId = items.length + 1;

            isDeleteMode = false;
            updateEditModeUI();
            renderList();
        });

        startBtn.addEventListener('click', startSlot);
        stopBtns.forEach((btn, index) => {
            btn.addEventListener('click', () => stopReel(index));
        });

        // --- é–¢æ•° ---
        
        // é …ç›®ã‚’è¿½åŠ ã™ã‚‹
        function addItem() {
            const text = itemInput.value.trim();
            if (!text) return;
            
            items.push({ id: nextId++, text: text });
            itemInput.value = '';
            itemInput.focus();
            renderList();
        }

        // ãƒªã‚¹ãƒˆã‚’æç”»ã™ã‚‹
        function renderList() {
            itemCount.innerText = items.length;

            // é …ç›®ãŒ0ã«ãªã£ãŸã‚‰å¼·åˆ¶çš„ã«å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰ã‚’è§£é™¤ã™ã‚‹
            if (items.length === 0 && isDeleteMode) {
                isDeleteMode = false;
                updateEditModeUI();
            }

            if (items.length === 0) {
                itemList.innerHTML = '<li class="text-gray-400 italic text-center py-8 text-sm sm:text-base">é …ç›®ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</li>';
                return;
            }

            itemList.innerHTML = items.map(item => `
                <li class="bg-white p-2 sm:p-3 rounded-lg border border-gray-200 shadow-sm transition hover:bg-gray-50">
                    <label class="flex items-center w-full cursor-pointer">
                        ${isDeleteMode ? `<input type="checkbox" value="${item.id}" class="delete-checkbox w-5 h-5 sm:w-6 sm:h-6 mr-3 sm:mr-4 accent-red-500 cursor-pointer flex-shrink-0">` : ''}
                        <span class="inline-block bg-blue-100 text-blue-800 font-black rounded-md w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center mr-3 sm:mr-4 flex-shrink-0 text-base sm:text-lg border border-blue-200">
                            ${item.id}
                        </span>
                        <span class="text-gray-800 font-bold text-base sm:text-lg truncate">${item.text}</span>
                    </label>
                </li>
            `).join('');
        }

        // å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰æ™‚ã®UIåˆ‡ã‚Šæ›¿ãˆ
        function updateEditModeUI() {
            if (isDeleteMode) {
                editBtn.classList.add('hidden');
                deleteSelectedBtn.classList.remove('hidden');
                cancelEditBtn.classList.remove('hidden');
                
                // å‰Šé™¤ä¸­ã¯å…¥åŠ›ã¨ã‚¹ãƒ­ãƒƒãƒˆé–‹å§‹ã‚’ãƒ­ãƒƒã‚¯
                itemInput.disabled = true;
                addBtn.disabled = true;
                itemInput.classList.add('opacity-50', 'bg-gray-100');
                addBtn.classList.add('opacity-50', 'cursor-not-allowed');
                
                startBtn.disabled = true;
                startBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                editBtn.classList.remove('hidden');
                deleteSelectedBtn.classList.add('hidden');
                cancelEditBtn.classList.add('hidden');
                
                itemInput.disabled = false;
                addBtn.disabled = false;
                itemInput.classList.remove('opacity-50', 'bg-gray-100');
                addBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                
                startBtn.disabled = false;
                startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // è¡¨ç¤ºç”¨ã®ãƒ©ãƒ³ãƒ€ãƒ ãªIDã‚’å–å¾—ã™ã‚‹ï¼ˆå›è»¢ä¸­ã®è¦–è¦šåŠ¹æœç”¨ï¼‰
        function getRandomId(validIds) {
            return validIds[Math.floor(Math.random() * validIds.length)];
        }

        // é…åˆ—ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã™ã‚‹
        function shuffleArray(array) {
            const newArr = [...array];
            for (let i = newArr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
            }
            return newArr;
        }

        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹
        function showError(msg) {
            const errorEl = document.getElementById('error-message');
            errorEl.innerText = msg;
            errorEl.classList.remove('hidden');
            
            // å°‘ã—é…ã‚‰ã›ã¦opacityã‚’1ã«ã™ã‚‹ã“ã¨ã§ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
            setTimeout(() => {
                errorEl.classList.remove('opacity-0');
                errorEl.classList.add('opacity-100');
            }, 10);
            
            // 3ç§’å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
            setTimeout(() => {
                errorEl.classList.remove('opacity-100');
                errorEl.classList.add('opacity-0');
                setTimeout(() => errorEl.classList.add('hidden'), 300); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã«å®Œå…¨ã«éš ã™
            }, 3000);
        }

        // ã‚¹ãƒ­ãƒƒãƒˆã‚’é–‹å§‹ã™ã‚‹
        function startSlot() {
            // è¢«ã‚Šãªã—ã§3ã¤æŠ½å‡ºã™ã‚‹ãŸã‚ã€æœ€ä½3ã¤å¿…è¦ã¨ã™ã‚‹
            if (items.length < 3) {
                showError('ã‚¹ãƒ­ãƒƒãƒˆã‚’å›ã™ã«ã¯ã€ãƒªã‚¹ãƒˆã«æœ€ä½3ã¤ã®é …ç›®ãŒå¿…è¦ã§ã™ï¼');
                return;
            }

            isSpinning = true;
            stoppedReels = 0;
            isReelStopped = [false, false, false];
            resultContainer.classList.add('hidden');
            resultArea.innerHTML = '';
            
            // å…¥åŠ›æ“ä½œã®ãƒ­ãƒƒã‚¯
            itemInput.disabled = true;
            addBtn.disabled = true;
            editBtn.disabled = true;
            itemInput.classList.add('opacity-50', 'cursor-not-allowed');
            addBtn.classList.add('opacity-50', 'cursor-not-allowed');
            editBtn.classList.add('opacity-50', 'cursor-not-allowed');
            
            // ãƒœã‚¿ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆ
            startBtn.classList.add('hidden');
            stopBtnsContainer.classList.remove('hidden');
            stopBtns.forEach(btn => btn.disabled = false); // å…¨ã‚¹ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–

            const validIds = items.map(item => item.id);
            const displayIds = [...validIds, STAR_MARK]; // å›è»¢ä¸­ã®è¡¨ç¤ºã«ã¯æ˜Ÿå½¢ã‚‚å«ã‚ã‚‹

            // --- å‡ºç›®ã®æŠ½é¸ãƒ­ã‚¸ãƒƒã‚¯ ---
            // 10%ã®ç¢ºç‡ã§æ˜Ÿå½¢ãƒãƒ¼ã‚¯ãŒæƒã†
            const isStarHit = Math.random() < 0.10;

            if (isStarHit) {
                // æ˜Ÿå½¢ãƒãƒ¼ã‚¯ãŒæƒã†å ´åˆ
                targetReelValues = [STAR_MARK, STAR_MARK, STAR_MARK];
            } else {
                // é€šå¸¸ã®å ´åˆï¼šé‡è¤‡ãªã—ã§3ã¤ã®é …ç›®ã‚’ã‚»ãƒƒãƒˆ
                const shuffled = shuffleArray(validIds);
                targetReelValues = [shuffled[0], shuffled[1], shuffled[2]];
            }

            // --- 3ã¤ã®ãƒªãƒ¼ãƒ«ã‚’å›è»¢ã•ã›ã‚‹ï¼ˆè¦–è¦šåŠ¹æœï¼‰ ---
            for (let i = 0; i < 3; i++) {
                document.getElementById(`reel-${i}-top`).classList.add('blur-text');
                document.getElementById(`reel-${i}-center`).classList.add('blur-text');
                document.getElementById(`reel-${i}-bottom`).classList.add('blur-text');
                
                reelIntervals[i] = setInterval(() => {
                    document.getElementById(`reel-${i}-top`).innerText = getRandomId(displayIds);
                    document.getElementById(`reel-${i}-center`).innerText = getRandomId(displayIds);
                    document.getElementById(`reel-${i}-bottom`).innerText = getRandomId(displayIds);
                }, 100); // ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿã‚’å°‘ã—ã‚†ã£ãã‚Šã«èª¿æ•´ï¼ˆ50ms -> 100msï¼‰
            }
        }

        // æŒ‡å®šã—ãŸãƒªãƒ¼ãƒ«ã‚’æ­¢ã‚ã‚‹ï¼ˆã©ã‚Œã‹ã‚‰ã§ã‚‚OKï¼‰
        function stopReel(reelIndex) {
            if (!isSpinning || isReelStopped[reelIndex]) return;

            const validIds = items.map(item => item.id);
            const displayIds = [...validIds, STAR_MARK];
            
            // å¯¾è±¡ã®ãƒªãƒ¼ãƒ«ã®å›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢
            clearInterval(reelIntervals[reelIndex]);
            
            // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è§£é™¤
            document.getElementById(`reel-${reelIndex}-top`).classList.remove('blur-text');
            document.getElementById(`reel-${reelIndex}-center`).classList.remove('blur-text');
            document.getElementById(`reel-${reelIndex}-bottom`).classList.remove('blur-text');

            // --- çµæœã®ç¢ºå®šè¡¨ç¤º ---
            // ä¸­å¤®ã«ã¯æŠ½é¸æ¸ˆã¿ã®ã€Œç¢ºå®šIDã€ã‚’è¡¨ç¤º
            document.getElementById(`reel-${reelIndex}-center`).innerText = targetReelValues[reelIndex];
            
            // ä¸Šä¸‹ã«ã¯ãƒ€ãƒŸãƒ¼ã§åˆ¥ã®IDã‚’è¡¨ç¤ºï¼ˆã‚¹ãƒ­ãƒƒãƒˆã®é›°å›²æ°—ã‚’å‡ºã™ãŸã‚ï¼‰
            let dummyTop = getRandomId(displayIds);
            while(dummyTop === targetReelValues[reelIndex] && displayIds.length > 1) dummyTop = getRandomId(displayIds);
            
            let dummyBottom = getRandomId(displayIds);
            while((dummyBottom === targetReelValues[reelIndex] || dummyBottom === dummyTop) && displayIds.length > 2) dummyBottom = getRandomId(displayIds);

            document.getElementById(`reel-${reelIndex}-top`).innerText = dummyTop;
            document.getElementById(`reel-${reelIndex}-bottom`).innerText = dummyBottom;

            // çŠ¶æ…‹ã®æ›´æ–°
            isReelStopped[reelIndex] = true;
            stoppedReels++;
            
            // æŠ¼ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ï¼ˆæ²ˆã¿è¾¼ã‚“ã è¦‹ãŸç›®ã«ãªã‚‹ï¼‰
            stopBtns[reelIndex].disabled = true;

            // å…¨ã¦åœæ­¢æ™‚ã®å‡¦ç†
            if (stoppedReels === 3) {
                isSpinning = false;
                
                // å°‘ã—ã ã‘ã€Œã‚¿ãƒ¡ã€ã‚’ä½œã£ã¦ã‹ã‚‰çµæœè¡¨ç¤º
                setTimeout(() => {
                    stopBtnsContainer.classList.add('hidden');
                    startBtn.classList.remove('hidden');
                    
                    // å…¥åŠ›æ“ä½œã®ãƒ­ãƒƒã‚¯è§£é™¤
                    itemInput.disabled = false;
                    addBtn.disabled = false;
                    editBtn.disabled = false;
                    itemInput.classList.remove('opacity-50', 'cursor-not-allowed');
                    addBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    editBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    
                    showResult();
                }, 600);
            }
        }

        // çµæœã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆãƒªã‚¹ãƒˆã¯æ¶ˆè²»ã—ãªã„ï¼‰
        function showResult() {
            const id1 = targetReelValues[0];
            const id2 = targetReelValues[1];
            const id3 = targetReelValues[2];

            const getItemData = (id) => {
                if (id === STAR_MARK) return { text: 'ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚¹ã‚¿ãƒ¼ï¼' };
                return items.find(i => i.id === id) || { text: 'ä¸æ˜ãªé …ç›®' };
            };

            const item1 = getItemData(id1);
            const item2 = getItemData(id2);
            const item3 = getItemData(id3);

            // æ–‡å­—æ•°ã‚’å³æƒãˆã§è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆæ˜Ÿå½¢ãƒãƒ¼ã‚¯ã®æ™‚ã¯è¡¨ç¤ºã—ãªã„ï¼‰
            const getLengthText = (id, text) => {
                if (id === STAR_MARK) return '';
                return `<div class="text-gray-500 font-bold ml-auto pl-2 whitespace-nowrap text-sm sm:text-base">(${text.length}æ–‡å­—)</div>`;
            };

            // ã˜ã‚ƒã‚“ã‘ã‚“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã®ãƒªã‚¹ãƒˆè¡¨ç¤ºç”Ÿæˆ
            let resultHTML = `
                <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 animate-pop-in">
                    <ul class="text-lg sm:text-xl md:text-2xl space-y-3 sm:space-y-4 font-bold text-gray-700">
                        <li class="flex items-center p-3 sm:p-4 bg-gray-50 rounded-xl border-2 border-gray-100 hover:border-blue-200 transition-colors">
                            <div class="w-12 h-12 sm:w-16 sm:h-16 bg-red-100 text-red-600 rounded-full flex items-center justify-center text-3xl sm:text-4xl mr-3 sm:mr-4 shadow-inner flex-shrink-0">âœŠ</div> 
                            <div class="flex flex-col overflow-hidden flex-grow pr-2">
                                <span class="text-xs sm:text-sm text-gray-500 font-normal">ã‚°ãƒ¼ (ç•ªå·: ${id1})</span>
                                <span class="truncate text-gray-800">${item1.text}</span>
                            </div>
                            ${getLengthText(id1, item1.text)}
                        </li>
                        <li class="flex items-center p-3 sm:p-4 bg-gray-50 rounded-xl border-2 border-gray-100 hover:border-yellow-200 transition-colors">
                            <div class="w-12 h-12 sm:w-16 sm:h-16 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center text-3xl sm:text-4xl mr-3 sm:mr-4 shadow-inner flex-shrink-0">âœŒï¸</div> 
                            <div class="flex flex-col overflow-hidden flex-grow pr-2">
                                <span class="text-xs sm:text-sm text-gray-500 font-normal">ãƒãƒ§ã‚­ (ç•ªå·: ${id2})</span>
                                <span class="truncate text-gray-800">${item2.text}</span>
                            </div>
                            ${getLengthText(id2, item2.text)}
                        </li>
                        <li class="flex items-center p-3 sm:p-4 bg-gray-50 rounded-xl border-2 border-gray-100 hover:border-green-200 transition-colors">
                            <div class="w-12 h-12 sm:w-16 sm:h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-3xl sm:text-4xl mr-3 sm:mr-4 shadow-inner flex-shrink-0">ğŸ–ï¸</div> 
                            <div class="flex flex-col overflow-hidden flex-grow pr-2">
                                <span class="text-xs sm:text-sm text-gray-500 font-normal">ãƒ‘ãƒ¼ (ç•ªå·: ${id3})</span>
                                <span class="truncate text-gray-800">${item3.text}</span>
                            </div>
                            ${getLengthText(id3, item3.text)}
                        </li>
                    </ul>
                </div>
            `;

            // æ˜Ÿå½¢ãƒãƒ¼ã‚¯ã®ãã‚ç›®åˆ¤å®šã¨ã‚¢ãƒŠã‚¦ãƒ³ã‚¹
            if (id1 === STAR_MARK && id2 === STAR_MARK && id3 === STAR_MARK) {
                resultHTML += `
                    <div class="mt-4 sm:mt-6 p-4 sm:p-6 bg-gradient-to-r from-blue-400 to-cyan-500 text-white font-bold rounded-2xl text-center shadow-xl animate-pop-in border-4 border-blue-200" style="animation-delay: 0.2s">
                        <div class="text-xl sm:text-3xl md:text-4xl mb-2 drop-shadow-md">ğŸŒŸ æ˜Ÿå½¢ãƒãƒ¼ã‚¯ãŒæƒã„ã¾ã—ãŸï¼ ğŸŒŸ</div>
                        <div class="text-base sm:text-xl md:text-2xl mt-3 sm:mt-4 bg-white/20 inline-block px-4 sm:px-6 py-2 rounded-full backdrop-blur-sm">
                            ğŸš° æ°´ã‚’é ¼ã‚€ã“ã¨ãŒã§ãã¾ã™ï¼ ğŸ’§
                        </div>
                    </div>
                `;
            }

            resultArea.innerHTML = resultHTML;
            resultContainer.classList.remove('hidden');

            // â€»ä»Šå›ã¯ãƒªã‚¹ãƒˆï¼ˆitemsï¼‰ã‹ã‚‰ã®å‰Šé™¤å‡¦ç†ã‚’ãªãã—ãŸãŸã‚ã€ãã®ã¾ã¾æ®‹ã‚Šã¾ã™ã€‚
        }
    </script>
</body>
</html>